@model FoodOrderSite.Models.ViewModels.AdminSettingsViewModel
@{
    ViewData["Title"] = "Ayarlar";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="card" style="margin-top: 4rem;">
    <div class="card-header">
        <h3 class="card-title">Görünüm Ayarları</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-12">
                <label class="form-label">Arkaplan Resmi</label>
                <div class="row g-3" id="imageGallery">
                    @foreach (var image in Model.AvailableImages)
                    {
                        <div class="col-md-3">
                            <div class="card h-100 @(Model.CurrentBackground == image ? "border-primary" : "")" 
                                 onclick="selectBackground('@image')" 
                                 style="cursor: pointer;">
                                <img src="/images/@image" class="card-img-top" alt="@image" style="height: 150px; object-fit: cover;">
                                <div class="card-body">
                                    <p class="card-text small text-center">@image</p>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Kaydet</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let selectedBackground = '@Model.CurrentBackground';

        function selectBackground(image) {
            selectedBackground = image;
            // Remove border from all cards
            document.querySelectorAll('#imageGallery .card').forEach(card => {
                card.classList.remove('border-primary');
            });
            // Add border to selected card
            event.currentTarget.classList.add('border-primary');
            // Update background
            updateBackground();
        }

        function updateBackground() {
            if (selectedBackground) {
                document.body.style.backgroundImage = `url('/images/${selectedBackground}')`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundPosition = 'center';
            }
        }

        function saveSettings() {
            const backgroundImage = selectedBackground || '';

            fetch('/Admin/SaveSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    backgroundImage: backgroundImage
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Başarılı!',
                        text: data.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata!',
                        text: data.message || 'Ayarlar kaydedilirken bir hata oluştu.'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Hata!',
                    text: 'Ayarlar kaydedilirken bir hata oluştu.'
                });
            });
        }

        // Initial setup
        if (selectedBackground) {
            updateBackground();
        }
    </script>

    <!-- SweetAlert2 için CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
} 