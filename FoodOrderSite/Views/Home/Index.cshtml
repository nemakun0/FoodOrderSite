@using System.Globalization
@using System.IO
@using FoodOrderSite.Models.ViewModels
@model IEnumerable<FoodOrderSite.Models.Product>
@{
    ViewData["Title"] = "Ana Sayfa";
}


<!-- Özel Başlık -->
<header class="custom-header">
    <div class="container-fluid position-relative px-3">
        <div class="position-absolute start-0 top-50 translate-middle-y ps-3">
            <i id="profileIcon" class="fas fa-user-circle fa-2x profile-icon"></i>
        </div>
        <div class="d-flex justify-content-center">
            <a class="logo" asp-controller="Home" asp-action="Index">ForkBase</a>
        </div>
        <div class="position-absolute end-0 top-50 translate-middle-y pe-3">
            <a asp-controller="Cart" asp-action="Index" id="cartIconLink" class="text-dark position-relative">
                <i class="fas fa-shopping-cart fa-2x"></i>
                @{
                    var data = Context.Session.GetString("Cart");
                    var count = data != null
                    ? (Newtonsoft.Json.JsonConvert.DeserializeObject<List<CartItemViewModel>>(data)?.Sum(x => x.Quantity) ?? 0)
                    : 0;
                }
                @if (count > 0)
                {
                    <span class="badge bg-danger rounded-circle position-absolute top-0 end-0">@count</span>
                }
            </a>
        </div>
    </div>
</header>

<!-- Profil Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-3">
            <div class="modal-header border-0">
                <h5 class="modal-title">Hoş geldin!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body text-center">
                <p>Devam etmek için giriş yap veya kayıt ol</p>
                <div class="d-grid gap-2">
                    <a href="/Signin/Index" class="btn btn-outline-primary">Giriş Yap</a> 
                    <a href="/Signup/Index" class="btn btn-primary">Kayıt Ol</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hero-Search Bölümü -->
<section class="hero-search-section">
    <!-- Video Container -->
    <div class="video-container">
        <!-- Videolar (kendi süreleri kadar oynayacak) -->
        <video muted class="bg-video">
            <source src="/videos/1_hamburger.mp4" type="video/mp4">
        </video>
        <video muted class="bg-video">
            <source src="/videos/2_doner.mp4" type="video/mp4">
        </video>
        <video muted class="bg-video">
            <source src="/videos/3_pide.mp4" type="video/mp4">
        </video>
        <video muted class="bg-video">
            <source src="/videos/4_pizza.mp4" type="video/mp4">
        </video>
        <video muted class="bg-video">
            <source src="/videos/5_kunefe.mp4" type="video/mp4">
        </video>
    </div>

    <!-- İçerik Overlay -->
    <div class="content-overlay container text-center">
        <h2 class="search-title mb-4">Discover Restaurants And More Near You.</h2>
        <div class="d-flex justify-content-center">
            <div class="input-group search-input-group" style="max-width:500px;">
                <span class="input-group-text bg-white"> <i class="fas fa-map-marker-alt text-danger"></i>
                </span>
                @if (ViewBag.Districts != null && ((List<string>)ViewBag.Districts).Any())
                {
                    <select class="form-select" id="districtSelect">
                        <option selected disabled>Enter delivery address district</option>
                        @foreach (var district in (List<string>)ViewBag.Districts)
                        {
                            <option value="@district">@district</option>
                        }
                    </select>
                }
                else
                {
                    <input type="text" class="form-control" placeholder="Enter delivery address district" id="districtSelect">
                }
                <button class="btn btn-danger" id="searchDistrictBtn"><i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        <button class="btn btn-warning mt-3" id="signInForSavedAddressBtn">Sign in for saved address</button>
    </div>
</section>

<!-- Harita Modalı (Leaflet için Geri Döndü) -->
<!-- Bu bölüm kaldırılacak -->

<!-- Kategoriler Bölümü -->
<section class="categories-section py-5 bg-light">
    <div class="container-fluid px-3">
        <h2 class="section-title text-center mb-4">Yemek Kategorileri</h2>
        <div class="row justify-content-center">
            @{
                // 16 kategori resmi
                var cats = new[] {
            "/images/category-burger.jpg",
            "/images/category-pizza.jpg",
            "/images/category-salad.jpg",
            "/images/category-dessert.jpg",
            "/images/category-soup.jpg",
            "/images/category-steak.jpg",
            "/images/category-seafood.jpg",
            "/images/category-pasta.jpg",
            "/images/category-sandwich.jpg",
            "/images/category-sushi.jpg",
            "/images/category-taco.jpg",
            "/images/category-noodles.jpg",
            "/images/category-curry.jpg",
            "/images/category-ramen.jpg",
            "/images/category-smoothie.jpg",
            "/images/category-coffee.jpg"
            };
            }
            @for (int i = 0; i < cats.Length; i++)
            {
                var hiddenClass = i < 4 ? "" : "d-none";
                // dosya adını al, prefix'i kaldır, ilk harfleri büyüt
                var fileName = System.IO.Path.GetFileNameWithoutExtension(cats[i]);           // e.g. "category-seafood"
                var rawName = fileName.Replace("category-", "");                   // e.g. "seafood"
                var displayName = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(rawName); // "Seafood"

                <div class="col-sm-6 col-md-3 mb-4 category-item @hiddenClass">
                    <div class="category-card text-center">
                        <div class="thumb-wrap">
                            <img src="@Url.Content(cats[i])" alt="@displayName" class="img-fluid" />
                        </div>
                        <p class="mt-2 fw-semibold">@displayName</p>
                    </div>
                </div>
            }
        </div>

        <!-- Butonlar -->
        <div class="text-center mt-3">
            <button id="loadMoreCategories" class="btn btn-primary">And More</button>
            <button id="showLessCategories" class="btn btn-danger d-none">Less</button>
        </div>
    </div>
</section>
@section scripts {
    @* Leaflet JS Kütüphanesi kaldırılacak *@

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Sadece Profil, Sepet, "Sign in for saved address", Kategori ve LoadMore scriptleri kalacak
            const profileIcon = document.getElementById('profileIcon');
            const profileModalElement = document.getElementById('profileModal');
            let userProfileModalInstance; 
            if (profileModalElement) {
                 userProfileModalInstance = new bootstrap.Modal(profileModalElement);
            }
            const profileModalTitleElement = profileModalElement ? profileModalElement.querySelector('.modal-title') : null;

            if (profileIcon && userProfileModalInstance) {
                profileIcon.addEventListener('click', function (event) {
                    event.preventDefault(); 
                    userProfileModalInstance.show();
                });
            }

            const signInForSavedAddressBtn = document.getElementById('signInForSavedAddressBtn');
            if (signInForSavedAddressBtn && userProfileModalInstance) {
                signInForSavedAddressBtn.addEventListener('click', function() {
                    userProfileModalInstance.show();
                });
            }

            const cartIconLink = document.getElementById('cartIconLink');
            if (cartIconLink && userProfileModalInstance) { 
                cartIconLink.addEventListener('click', function (event) {
                    let isLoggedIn = false; 
                    if (profileModalTitleElement && profileModalTitleElement.textContent.trim() !== 'Hoş geldin!') {
                        isLoggedIn = true;
                    }
                    if (!isLoggedIn) {
                        event.preventDefault(); 
                        userProfileModalInstance.show();
                    }
                });
            }

            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(function (item) {
                const card = item.querySelector('.category-card');
                if (card) {
                    card.addEventListener('click', function () {
                        const categoryNameElement = card.querySelector('p.fw-semibold');
                        if (categoryNameElement) {
                            const categoryName = categoryNameElement.textContent.trim();
                            window.location.href = '/Discover/Index?category=' + encodeURIComponent(categoryName);
                        }
                    });
                }
            });

            const loadBtn = document.getElementById('loadMoreCategories');
            const lessBtn = document.getElementById('showLessCategories');
            const allCategoryItemsForLoadMore = document.querySelectorAll('.category-item');
            if (loadBtn && lessBtn && allCategoryItemsForLoadMore.length > 0) {
                loadBtn.addEventListener('click', function() {
                  allCategoryItemsForLoadMore.forEach(el => el.classList.remove('d-none'));
                  loadBtn.classList.add('d-none');
                  lessBtn.classList.remove('d-none');
                });
                lessBtn.addEventListener('click', function() {
                  allCategoryItemsForLoadMore.forEach((el, idx) => {
                    if (idx >= 4) el.classList.add('d-none');
                  });
                  lessBtn.classList.add('d-none');
                  loadBtn.classList.remove('d-none');
                });
            }

            const searchDistrictBtn = document.getElementById('searchDistrictBtn');
            if (searchDistrictBtn) {
                searchDistrictBtn.addEventListener('click', function() {
                    const districtSelect = document.getElementById('districtSelect');
                    if (districtSelect) {
                        const selectedValue = districtSelect.value;
                        // Check if the selected value is not the placeholder value (which is not a valid district name)
                        if (selectedValue && districtSelect.selectedIndex > 0) { 
                            window.location.href = '/Discover/Index?district=' + encodeURIComponent(selectedValue);
                        } else {
                            // Optionally, alert the user or handle the case where no district is selected
                            // For now, if it's a text input or placeholder is selected, do nothing or redirect to general Discover page
                             window.location.href = '/Discover/Index'; // Or alert('Please select a district.');
                        }
                    }
                });
            }

            console.log('Non-map scripts in DOMContentLoaded loaded.');
        });
    </script>
}

<!-- Sizi Neler Bekliyor Bölümü -->
<section class="expectations-section py-5">
    <div class="container-fluid px-3">
        <h2 class="section-title text-center mb-4">ForkBase'de Sizi Neler Bekliyor?</h2>
        <ul class="list-unstyled fs-5">
            <li>✓ Yemek siparişinde onlarca kategori, binlerce çeşit ürün!</li>
            <li>✓ Yemek siparişlerinizde her gün on binlerce indirim!</li>
            <li>✓ Online ya da kapıda, dilediğiniz gibi ödeme seçeneği!</li>
            <li>✓ Siparişinizle ilgili size her zaman destek olmaya hazır, 7/24 Canlı Yardım ekibi!</li>
        </ul>
    </div>
</section>
